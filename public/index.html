<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Anti-cach√© y seguridad -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <!-- X-Frame-Options solo se puede configurar v√≠a headers HTTP (se maneja en server.js) -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="no-referrer">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    
    <title>Panel de Administraci√≥n - API Keys</title>
    <link rel="stylesheet" href="/css/style.css?v=<?php echo time(); ?>">
    <link rel="stylesheet" href="/css/ready-urls.css">
    <link rel="stylesheet" href="/css/welcome-modal.css">
    <link rel="stylesheet" href="/css/theme-toggle.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/security-tickets.css">
    <link rel="stylesheet" href="/css/ux-improvements.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Toggle de Tema Oscuro/Claro -->
    <div class="theme-toggle" id="theme-toggle">
        <i class="fas fa-moon theme-toggle-icon moon"></i>
        <i class="fas fa-sun theme-toggle-icon sun"></i>
        <div class="theme-toggle-switch"></div>
    </div>

    <!-- Pantalla de Login -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="terminal-header">
                <div class="terminal-buttons">
                    <span class="btn-red"></span>
                    <span class="btn-yellow"></span>
                    <span class="btn-green"></span>
                </div>
                <div class="terminal-title">root@api-control:~$</div>
            </div>
            
            <div class="login-content">
                <div class="ascii-art">
                    <pre>
       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
       ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù
    ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë 
      ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   
       ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù 
                    </pre>
                    <p class="subtitle">Sistema de Control de API Keys v2.0</p>
                </div>

                <form id="login-form" class="login-form">
                    <div class="form-group">
                        <label for="role">
                            <i class="fas fa-shield-alt"></i> Tipo de Acceso
                        </label>
                        <select id="role" name="role" required>
                            <option value="">Seleccionar rol...</option>
                            <option value="admin">üîë Administrador</option>
                            <option value="vendedor">üíº Vendedor</option>
                            <option value="cliente">üë§ Cliente</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="username">
                            <i class="fas fa-user"></i> Usuario
                        </label>
                        <input type="text" id="username" name="username" placeholder="Ingresa tu usuario" required>
                    </div>

                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-lock"></i> Contrase√±a
                        </label>
                        <input type="password" id="password" name="password" placeholder="Ingresa tu contrase√±a" required>
                    </div>

                    <button type="submit" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n
                    </button>

                    <div class="register-link">
                        <p style="text-align: center; color: var(--text-secondary); margin-top: 20px;">
                            ¬øQuieres pertenecer al panel? Contacta a un administrador:
                        </p>
                        <div class="admin-contacts" style="margin: 15px 0; text-align: center;">
                            <a href="https://t.me/zGatoO" target="_blank" class="admin-tag" style="text-decoration: none; display: inline-block; margin: 5px;">
                                <i class="fab fa-telegram"></i> @zGatoO
                            </a>
                            <a href="https://t.me/choco_tete" target="_blank" class="admin-tag" style="text-decoration: none; display: inline-block; margin: 5px;">
                                <i class="fab fa-telegram"></i> @choco_tete
                            </a>
                            <a href="https://t.me/WinniePoohOFC" target="_blank" class="admin-tag" style="text-decoration: none; display: inline-block; margin: 5px;">
                                <i class="fab fa-telegram"></i> @WinniePoohOFC
                            </a>
                        </div>
                    </div>
                </form>

                <div id="verification-form" class="verification-form hidden">
                    <h3><i class="fas fa-shield-alt"></i> Verificaci√≥n de IP Requerida</h3>
                    <p class="warning-text">üîí <strong>Nueva IP detectada.</strong> Se ha enviado un c√≥digo de verificaci√≥n a los administradores.</p>
                    
                    <div class="info-box" style="margin: 20px 0; background: rgba(255, 165, 0, 0.1); border: 1px solid #FFA500;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <p style="margin: 0;"><strong>Contacta a un administrador</strong></p>
                            <p style="margin: 5px 0 0 0; font-size: 14px;">Solo ellos pueden darte el c√≥digo de verificaci√≥n.</p>
                        </div>
                    </div>
                    
                    <div class="admin-contacts" style="margin: 20px 0;">
                        <p style="text-align: center; margin-bottom: 10px; color: var(--text-secondary);">üì± Contacta por Telegram:</p>
                        <span class="admin-tag">@zGatoO</span>
                        <span class="admin-tag">@choco_tete</span>
                        <span class="admin-tag">@WinniePoohOFC</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="verification-code">
                            <i class="fas fa-key"></i> Ingresa el c√≥digo que te proporcion√≥ el admin
                        </label>
                        <input type="text" id="verification-code" placeholder="Ej: ABC123" required>
                    </div>
                    <button id="verify-ip-btn" class="btn-primary">
                        <i class="fas fa-check"></i> Verificar C√≥digo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Registro eliminado - Los admins crean usuarios directamente -->

    <!-- Panel Principal -->
    <div id="dashboard-screen" class="screen">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-terminal"></i> API PANEL</h2>
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">A</div>
                    <div class="user-details">
                        <span class="user-name" id="user-name">Usuario</span>
                        <span class="user-role" id="user-role">admin</span>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="#" class="nav-item" data-section="keys">
                    <i class="fas fa-key"></i> Mis Keys
                </a>
                <a href="#" class="nav-item client-vendor-only" data-section="requests">
                    <i class="fas fa-shopping-cart"></i> Solicitar Keys
                    <span class="notification-badge" id="requests-count">0</span>
                </a>
                <a href="#" class="nav-item admin-vendor-only" data-section="pending-requests">
                    <i class="fas fa-tasks"></i> Aprobar Solicitudes
                    <span class="notification-badge" id="pending-count">0</span>
                </a>
                <a href="#" class="nav-item admin-only" data-section="users">
                    <i class="fas fa-users"></i> Usuarios
                </a>
                <a href="#" class="nav-item admin-only" data-section="notifications">
                    <i class="fas fa-bell"></i> Notificaciones
                    <span class="notification-badge" id="notification-count">0</span>
                </a>
                <a href="#" class="nav-item" data-section="tickets">
                    <i class="fas fa-ticket-alt"></i> Soporte
                    <span class="notification-badge" id="tickets-count">0</span>
                </a>
                <a href="#" class="nav-item admin-only" data-section="security">
                    <i class="fas fa-shield-alt"></i> Seguridad
                </a>
                <a href="#" class="nav-item" data-section="help">
                    <i class="fas fa-question-circle"></i> Ayuda
                </a>
                <a href="#" class="nav-item" data-section="profile">
                    <i class="fas fa-user-circle"></i> Mi Perfil
                </a>
            </nav>

            <div class="sidebar-footer">
                <button id="logout-btn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                </button>
            </div>
        </aside>

        <!-- Contenido Principal -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <div class="section-header">
                    <h1><i class="fas fa-chart-line"></i> Dashboard</h1>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="stat-details">
                            <h3 id="total-keys">0</h3>
                            <p>Keys Activas</p>
                        </div>
                    </div>

                    <div class="stat-card admin-only">
                        <div class="stat-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-details">
                            <h3 id="total-users">0</h3>
                            <p>Usuarios Totales</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-details">
                            <h3 id="active-endpoints">0</h3>
                            <p>Endpoints Activos</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon red">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-details">
                            <h3 id="expiring-keys">0</h3>
                            <p>Keys por Vencer</p>
                        </div>
                    </div>
                </div>

                <div class="api-endpoints-list">
                    <h2><i class="fas fa-list"></i> Endpoints Disponibles</h2>
                    <div class="endpoints-grid" id="endpoints-grid">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>
            </section>

            <!-- Keys Section -->
            <section id="keys-section" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-key"></i> Gesti√≥n de API Keys</h1>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-primary" id="create-key-btn">
                            <i class="fas fa-plus"></i> Crear Nueva Key
                        </button>
                        <button class="btn-danger admin-only" id="delete-all-keys-btn" style="display: none;">
                            <i class="fas fa-trash-alt"></i> Eliminar Todas las Keys
                        </button>
                    </div>
                </div>

                <div class="keys-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Endpoint</th>
                                <th>Duraci√≥n</th>
                                <th>Expira</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="keys-table-body">
                            <!-- Se llenar√° din√°micamente -->
                        </tbody>
                    </table>
                </div>

                <!-- URLs Listas para copiar -->
                <div class="card" style="margin-top: 20px;" id="ready-urls-container">
                    <h2><i class="fas fa-link"></i> URLs Listas para Usar</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">
                        Copia directamente la URL completa con tu API Key incluida.
                    </p>
                    <div id="ready-urls-list">
                        <!-- Se llenar√° din√°micamente con las keys activas -->
                    </div>
                </div>
            </section>

            <!-- Users Section (Solo Admin) -->
            <section id="users-section" class="content-section admin-only">
                <div class="section-header">
                    <h1><i class="fas fa-users"></i> Gesti√≥n de Usuarios</h1>
                    <button class="btn-primary" id="create-user-btn">
                        <i class="fas fa-user-plus"></i> Crear Usuario
                    </button>
                </div>

                <div class="users-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Rol</th>
                                <th>Telegram</th>
                                <th>Estado</th>
                                <th>Expira</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Se llenar√° din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Notifications Section (Solo Admin) -->
            <section id="notifications-section" class="content-section admin-only">
                <div class="section-header">
                    <h1><i class="fas fa-bell"></i> Notificaciones y C√≥digos</h1>
                    <button class="btn-danger" id="clear-all-notifications-btn">
                        <i class="fas fa-trash-alt"></i> Limpiar Todas
                    </button>
                </div>

                <div class="notifications-list" id="notifications-list">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </section>

            <!-- Requests Section (Solicitar Keys) -->
            <section id="requests-section" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-shopping-cart"></i> Solicitar API Keys</h1>
                </div>

                <div class="request-form-container">
                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <p>Selecciona los endpoints que necesitas y la duraci√≥n. Tu solicitud ser√° enviada al administrador para aprobaci√≥n.</p>
                    </div>

                    <form id="request-keys-form">
                        <h3><i class="fas fa-list-check"></i> Selecciona Endpoints y Duraci√≥n</h3>
                        <div id="endpoints-request-container">
                            <!-- Se llenar√° din√°micamente -->
                        </div>

                        <button type="submit" class="btn-primary">
                            <i class="fas fa-paper-plane"></i> Enviar Solicitud
                        </button>
                    </form>

                    <div class="my-requests-container">
                        <h2><i class="fas fa-history"></i> Mis Solicitudes</h2>
                        <div id="my-requests-list">
                            <!-- Se llenar√° din√°micamente -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Pending Requests Section (Admin/Vendedor) -->
            <section id="pending-requests-section" class="content-section admin-vendor-only">
                <div class="section-header">
                    <h1><i class="fas fa-tasks"></i> Aprobar Solicitudes de Keys</h1>
                </div>

                <div class="pending-requests-list" id="pending-requests-list">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile-section" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-user-circle"></i> Mi Perfil</h1>
                </div>

                <div class="profile-container">
                    <form id="profile-form" class="profile-form">
                        <div class="form-group">
                            <label><i class="fas fa-user"></i> Usuario</label>
                            <input type="text" id="profile-username" readonly>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-shield-alt"></i> Rol</label>
                            <input type="text" id="profile-role" readonly>
                        </div>

                        <div class="form-group">
                            <label><i class="fab fa-telegram"></i> Telegram</label>
                            <input type="text" id="profile-telegram">
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-lock"></i> Nueva Contrase√±a</label>
                            <input type="password" id="profile-password" placeholder="Dejar vac√≠o para no cambiar">
                        </div>

                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Guardar Cambios
                        </button>
                    </form>
                </div>
            </section>

            <!-- Secci√≥n de Tickets de Soporte -->
            <section id="tickets-section" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-ticket-alt"></i> Centro de Soporte</h1>
                    <button class="btn-primary" id="create-ticket-btn">
                        <i class="fas fa-plus"></i> Nuevo Ticket
                    </button>
                </div>

                <div class="tickets-container">
                    <!-- Filtros -->
                    <div class="tickets-filters">
                        <select id="ticket-status-filter" class="filter-select">
                            <option value="">Todos los Estados</option>
                            <option value="open">Abiertos</option>
                            <option value="in_progress">En Progreso</option>
                            <option value="waiting_response">Esperando Respuesta</option>
                            <option value="resolved">Resueltos</option>
                            <option value="closed">Cerrados</option>
                        </select>

                        <select id="ticket-priority-filter" class="filter-select">
                            <option value="">Todas las Prioridades</option>
                            <option value="urgent">Urgente</option>
                            <option value="high">Alta</option>
                            <option value="medium">Media</option>
                            <option value="low">Baja</option>
                        </select>
                    </div>

                    <!-- Lista de tickets -->
                    <div id="tickets-list" class="tickets-list">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de Seguridad (Admin only) -->
            <section id="security-section" class="content-section admin-only">
                <div class="section-header">
                    <h1><i class="fas fa-shield-alt"></i> Centro de Seguridad</h1>
                </div>

                <div class="security-tabs">
                    <button class="tab-btn active" data-tab="blacklist">IPs Bloqueadas</button>
                    <button class="tab-btn" data-tab="audit-logs">Auditor√≠a</button>
                    <button class="tab-btn" data-tab="api-logs">Logs de API</button>
                </div>

                <!-- Tab: Blacklist -->
                <div id="blacklist-tab" class="security-tab-content active">
                    <div class="tab-header">
                        <h2>IPs Bloqueadas</h2>
                        <button class="btn-primary" id="block-ip-btn">
                            <i class="fas fa-ban"></i> Bloquear IP
                        </button>
                    </div>
                    <div id="blacklist-container" class="data-table-container">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>

                <!-- Tab: Audit Logs -->
                <div id="audit-logs-tab" class="security-tab-content">
                    <div class="tab-header">
                        <h2>Registro de Auditor√≠a</h2>
                        <div class="filter-group">
                            <select id="audit-action-filter">
                                <option value="">Todas las Acciones</option>
                                <option value="login">Login</option>
                                <option value="create_key">Crear Key</option>
                                <option value="delete_key">Eliminar Key</option>
                                <option value="create_user">Crear Usuario</option>
                                <option value="block_ip">Bloquear IP</option>
                            </select>
                            <button class="btn-secondary" id="export-audit-btn">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div id="audit-logs-container" class="data-table-container">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>

                <!-- Tab: API Logs -->
                <div id="api-logs-tab" class="security-tab-content">
                    <div class="tab-header">
                        <h2>Logs de Consultas API</h2>
                        <div class="stats-summary">
                            <div class="stat-item">
                                <span class="stat-label">Total Consultas:</span>
                                <span class="stat-value" id="total-requests">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Tasa de √âxito:</span>
                                <span class="stat-value" id="success-rate">0%</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Cach√© Hit Rate:</span>
                                <span class="stat-value" id="cache-hit-rate">0%</span>
                            </div>
                        </div>
                    </div>
                    <div id="api-logs-container" class="data-table-container">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>
            </section>

            <!-- Secci√≥n de Ayuda / Base de Conocimiento -->
            <section id="help-section" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-question-circle"></i> Centro de Ayuda</h1>
                </div>

                <div class="help-search">
                    <input type="text" id="help-search-input" placeholder="üîç Buscar en la ayuda...">
                </div>

                <div class="help-categories">
                    <!-- Primeros Pasos -->
                    <div class="help-category animate-fade-in-up">
                        <div class="help-category-header">
                            <i class="fas fa-rocket"></i>
                            <h2>Primeros Pasos</h2>
                        </div>
                        <div class="help-items">
                            <div class="help-item">
                                <h3>¬øC√≥mo crear mi primera API Key?</h3>
                                <p>Ve a la secci√≥n "Mis Keys" ‚Üí Click en "Nueva Key" ‚Üí Selecciona el endpoint que necesites ‚Üí Especifica la duraci√≥n ‚Üí Click en "Generar Key"</p>
                            </div>
                            <div class="help-item">
                                <h3>¬øC√≥mo usar mi API Key?</h3>
                                <p>Agrega el par√°metro <code>?key=TU_KEY</code> al final de cualquier URL del endpoint. Ejemplo: <code>https://api.com/dni?dni=12345678&key=tu_key_aqui</code></p>
                            </div>
                            <div class="help-item">
                                <h3>¬øQu√© endpoints est√°n disponibles?</h3>
                                <p><strong>DNI:</strong> Datos personales completos<br>
                                <strong>TELP:</strong> B√∫squeda por tel√©fono<br>
                                <strong>NOM:</strong> B√∫squeda por nombres<br>
                                <strong>ARG:</strong> √Årbol geneal√≥gico<br>
                                <strong>RISK:</strong> Datos de riesgo crediticio<br>
                                <strong>FOTO:</strong> Fotograf√≠a en base64<br>
                                <strong>SUNAT:</strong> Historial laboral<br>
                                <strong>META:</strong> Todos los datos disponibles</p>
                            </div>
                        </div>
                    </div>

                    <!-- FAQs -->
                    <div class="help-category animate-fade-in-up delay-100">
                        <div class="help-category-header">
                            <i class="fas fa-question"></i>
                            <h2>Preguntas Frecuentes</h2>
                        </div>
                        <div class="help-items">
                            <div class="help-item">
                                <h3>¬øPuedo renovar una key expirada?</h3>
                                <p>S√≠, las keys con el bot√≥n "Renovar" pueden extenderse. Click en el bot√≥n, especifica el nuevo tiempo y listo.</p>
                            </div>
                            <div class="help-item">
                                <h3>¬øQu√© pasa si excedo el l√≠mite de peticiones?</h3>
                                <p>Hay un l√≠mite de 100 peticiones cada 15 minutos. Si lo excedes, recibir√°s un error 429. Espera 15 minutos o contacta a soporte para aumentar tu l√≠mite.</p>
                            </div>
                            <div class="help-item">
                                <h3>¬øMi IP puede ser bloqueada?</h3>
                                <p>S√≠, si detectamos actividad sospechosa o exceso de peticiones, tu IP puede ser bloqueada autom√°ticamente. Usa la API responsablemente.</p>
                            </div>
                            <div class="help-item">
                                <h3>¬øC√≥mo solicito m√°s endpoints?</h3>
                                <p>Ve a "Solicitar Keys" ‚Üí Selecciona los endpoints que necesites ‚Üí Elige la duraci√≥n ‚Üí Env√≠a la solicitud. Un admin/vendedor la aprobar√° pronto.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Roles y Permisos -->
                    <div class="help-category animate-fade-in-up delay-200" id="roles-help">
                        <div class="help-category-header">
                            <i class="fas fa-users-cog"></i>
                            <h2>Roles y Permisos</h2>
                        </div>
                        <div class="help-items">
                            <div class="help-item">
                                <h3>üë§ Cliente</h3>
                                <p><strong>Puede:</strong> Crear keys para s√≠ mismo, solicitar nuevos endpoints, ver sus propias keys y consultas, abrir tickets de soporte.</p>
                                <p><strong>No puede:</strong> Ver otros usuarios, aprobar solicitudes, acceder a logs del sistema.</p>
                            </div>
                            <div class="help-item">
                                <h3>üíº Vendedor</h3>
                                <p><strong>Puede:</strong> Todo lo del Cliente + Crear hasta 5 usuarios tipo Cliente, aprobar solicitudes de keys de sus clientes, ver logs de sus clientes.</p>
                                <p><strong>No puede:</strong> Crear otros vendedores, ver usuarios de otros vendedores, acceder a seguridad del sistema.</p>
                            </div>
                            <div class="help-item">
                                <h3>üõ°Ô∏è Administrador</h3>
                                <p><strong>Puede:</strong> TODO. Gesti√≥n completa de usuarios, keys, seguridad, logs, blacklist, auditor√≠a, configuraci√≥n del sistema.</p>
                                <p><strong>Responsabilidades:</strong> Monitorear el sistema, aprobar usuarios nuevos, revisar actividad sospechosa.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Soporte -->
                    <div class="help-category animate-fade-in-up delay-300">
                        <div class="help-category-header">
                            <i class="fas fa-life-ring"></i>
                            <h2>Contacto y Soporte</h2>
                        </div>
                        <div class="help-items">
                            <div class="help-item">
                                <h3>¬øNecesitas ayuda personalizada?</h3>
                                <p>Abre un ticket en la secci√≥n "Soporte" del panel. Responderemos lo antes posible.</p>
                            </div>
                            <div class="help-item">
                                <h3>Contactos de Emergencia</h3>
                                <p>
                                    <strong>Telegram:</strong><br>
                                    ‚Ä¢ @zGatoO - Administrador Principal<br>
                                    ‚Ä¢ @choco_tete - Soporte T√©cnico<br>
                                    ‚Ä¢ @WinniePoohOFC - Desarrollo
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para crear Key -->
    <div id="create-key-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> Crear Nueva API Key</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="create-key-form">
                <div class="form-group">
                    <label for="key-endpoint">Endpoint</label>
                    <select id="key-endpoint" name="endpoint" required>
                        <option value="">Seleccionar endpoint...</option>
                        <option value="dni">üìã DNI - Consulta de personas</option>
                        <option value="telp">üì± TELP - Tel√©fonos</option>
                        <option value="nom">üë§ NOM - B√∫squeda por nombres</option>
                        <option value="arg">üå≥ ARG - √Årbol geneal√≥gico</option>
                        <option value="corr">üìß CORR - Correos electr√≥nicos</option>
                        <option value="risk">‚ö†Ô∏è RISK - Datos de riesgo</option>
                        <option value="foto">üì∑ FOTO - Fotograf√≠as</option>
                        <option value="sunat">üè¢ SUNAT - Datos laborales</option>
                        <option value="meta">üîç META - Todos los datos</option>
                        <option value="all" class="admin-only">üîì ALL - Acceso total</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="key-duration-amount">‚è∞ Duraci√≥n Personalizada</label>
                    <div class="duration-input-group">
                        <input type="number" id="key-duration-amount" name="durationAmount" 
                               placeholder="Ej: 30" min="1" max="1000" required>
                        <select id="key-duration-unit" name="durationUnit" required>
                            <option value="horas">Horas</option>
                            <option value="dias">D√≠as</option>
                            <option value="meses" selected>Meses</option>
                        </select>
                    </div>
                    <small style="color: var(--text-secondary); margin-top: 5px; display: block;">
                        Ejemplo: 30 horas, 7 d√≠as, 2 meses
                    </small>
                </div>

                <div class="form-group admin-vendor-only">
                    <label for="key-user">Asignar a Usuario (Opcional)</label>
                    <select id="key-user" name="userId">
                        <option value="">Para m√≠ mismo</option>
                        <!-- Se llenar√° din√°micamente con clientes -->
                    </select>
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-plus"></i> Generar Key
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para crear Usuario -->
    <div id="create-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Crear Usuario</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="create-user-form">
                <div class="form-group">
                    <label for="user-username">Usuario</label>
                    <input type="text" id="user-username" name="username" required>
                </div>

                <div class="form-group">
                    <label for="user-password">Contrase√±a</label>
                    <input type="password" id="user-password" name="password" required>
                </div>

                <div class="form-group">
                    <label for="user-role">Rol</label>
                    <select id="user-role" name="role" required>
                        <option value="">Seleccionar rol...</option>
                        <option value="vendedor" class="admin-only">üíº Vendedor</option>
                        <option value="cliente">üë§ Cliente</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="user-telegram">Telegram</label>
                    <input type="text" id="user-telegram" name="telegram" placeholder="@usuario" required>
                </div>

                <div class="form-group">
                    <label for="user-duration">Duraci√≥n de Acceso</label>
                    <select id="user-duration" name="duration" required>
                        <option value="">Seleccionar duraci√≥n...</option>
                        <option value="1d">1 D√≠a</option>
                        <option value="7d">7 D√≠as</option>
                        <option value="1m">1 Mes</option>
                        <option value="2m">2 Meses</option>
                        <option value="6m">6 Meses</option>
                        <option value="1y">1 A√±o</option>
                        <option value="permanent" class="admin-only">Permanente</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Endpoints Permitidos</label>
                    <div class="checkbox-group" id="endpoints-checkboxes">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-user-plus"></i> Crear Usuario
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para Renovar Key -->
    <div id="renew-key-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-redo"></i> Renovar API Key</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="renew-key-form">
                <input type="hidden" id="renew-key-id" name="keyId">
                
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <p>La key se renovar√° desde AHORA, agregando el tiempo que especifiques</p>
                </div>

                <div class="form-group">
                    <label for="renew-duration-amount">‚è∞ Agregar Tiempo</label>
                    <div class="duration-input-group">
                        <input type="number" id="renew-duration-amount" name="durationAmount" 
                               placeholder="Ej: 30" min="1" max="1000" required>
                        <select id="renew-duration-unit" name="durationUnit" required>
                            <option value="horas">Horas</option>
                            <option value="dias">D√≠as</option>
                            <option value="meses" selected>Meses</option>
                        </select>
                    </div>
                    <small style="color: var(--text-secondary); margin-top: 5px; display: block;">
                        La key expirar√° en el tiempo que especifiques desde ahora
                    </small>
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-redo"></i> Renovar Key
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para crear Ticket -->
    <div id="create-ticket-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-ticket-alt"></i> Nuevo Ticket de Soporte</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="create-ticket-form">
                <div class="form-group">
                    <label for="ticket-subject">Asunto</label>
                    <input type="text" id="ticket-subject" name="subject" placeholder="Describe brevemente tu problema" required maxlength="200">
                </div>

                <div class="form-group">
                    <label for="ticket-category">Categor√≠a</label>
                    <select id="ticket-category" name="category" required>
                        <option value="technical">üîß T√©cnico</option>
                        <option value="billing">üí∞ Facturaci√≥n</option>
                        <option value="feature_request">üí° Nueva Funci√≥n</option>
                        <option value="bug_report">üêõ Reporte de Bug</option>
                        <option value="other">‚ùì Otro</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="ticket-priority">Prioridad</label>
                    <select id="ticket-priority" name="priority" required>
                        <option value="low">Baja</option>
                        <option value="medium" selected>Media</option>
                        <option value="high">Alta</option>
                        <option value="urgent">Urgente</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="ticket-message">Mensaje</label>
                    <textarea id="ticket-message" name="message" rows="6" placeholder="Describe tu problema en detalle..." required></textarea>
                </div>

                <button type="submit" class="btn-primary">
                    <i class="fas fa-paper-plane"></i> Enviar Ticket
                </button>
            </form>
        </div>
    </div>

    <!-- Modal de Bienvenida al crear Key -->
    <div id="welcome-key-modal" class="modal">
        <div class="modal-content modal-welcome">
            <div class="modal-header modal-header-success">
                <h2><i class="fas fa-check-circle"></i> ¬°Key Creada Exitosamente!</h2>
                <button class="modal-close" onclick="closeWelcomeModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Animaci√≥n de √©xito -->
                <div class="success-animation">
                    <div class="checkmark-circle">
                        <div class="checkmark"></div>
                    </div>
                </div>

                <!-- Informaci√≥n de la key -->
                <div class="key-info-box">
                    <h3><i class="fas fa-key"></i> Tu Nueva API Key</h3>
                    <div class="key-display" id="welcome-key-value">
                        <code>XXXXXXXXXXXXXXXXX</code>
                        <button class="btn-copy-inline" onclick="copyWelcomeKey()">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p class="key-details">
                        <strong>Endpoint:</strong> <span id="welcome-endpoint">DNI</span><br>
                        <strong>Duraci√≥n:</strong> <span id="welcome-duration">30 d√≠as</span><br>
                        <strong>Expira:</strong> <span id="welcome-expires">31/12/2024</span>
                    </p>
                </div>

                <!-- URLs de ejemplo -->
                <div class="url-example-box">
                    <h3><i class="fas fa-link"></i> Links Listos para Usar</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Copia el link que necesites y reemplaza el DNI/tel√©fono/nombre de ejemplo con datos reales:
                    </p>
                    <div id="welcome-url-display" class="url-examples-container">
                        <!-- Se llenar√° din√°micamente con los ejemplos -->
                    </div>
                </div>

                <!-- T√©rminos y Condiciones seg√∫n rol -->
                <div class="terms-box" id="welcome-terms">
                    <!-- Se llenar√° din√°micamente seg√∫n el rol -->
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-primary btn-large" onclick="closeWelcomeModal()">
                    <i class="fas fa-check"></i> Entendido, Comenzar a Usar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Scripts -->
    <script src="/js/theme.js"></script>
    <script src="/js/ux-helpers.js"></script>
    <script src="/js/onboarding.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>

